<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Extension Vibe n8n - Firebase Auth + Pricing</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .status {
            padding: 12px;
            border-radius: 8px;
            margin: 10px 0;
        }
        .success { background: #d1fae5; color: #065f46; }
        .error { background: #fee2e2; color: #991b1b; }
        .warning { background: #fef3c7; color: #92400e; }
        .info { background: #dbeafe; color: #1e40af; }
        .test-btn {
            background: #4285f4;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
        }
        .test-btn:hover {
            background: #3367d6;
        }
        .results {
            margin-top: 20px;
            padding: 15px;
            background: #f9fafb;
            border-radius: 8px;
        }
        pre {
            background: #1f2937;
            color: #f9fafb;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
        }
    </style>
    
    <!-- Firebase v9 SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js';
        import { getAuth, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js';
        
        // Configuration Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyDPB8tHayuvKuhimMQPbJBBLvukFLJIZ8I",
            authDomain: "vibe-n8n-7e40d.firebaseapp.com",
            projectId: "vibe-n8n-7e40d",
            storageBucket: "vibe-n8n-7e40d.firebasestorage.app",
            messagingSenderId: "247816285693",
            appId: "1:247816285693:web:1229eea4a52d6d765afd94",
            measurementId: "G-1CLFCN7KVL"
        };
        
        // Initialisation Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        
        // Rendre Firebase disponible globalement
        window.firebaseApp = app;
        window.firebaseAuth = auth;
        
        console.log('🔥 Firebase SDK chargé et initialisé');
        
        // Écouter les changements d'authentification
        onAuthStateChanged(auth, (user) => {
            if (user) {
                console.log('✅ Utilisateur connecté:', user.email);
                updateResults(`✅ Utilisateur connecté: ${user.email}`, 'success');
            } else {
                console.log('❌ Utilisateur non connecté');
                updateResults('❌ Utilisateur non connecté', 'warning');
            }
        });
    </script>
</head>
<body>
    <h1>🧪 Test Extension Vibe n8n</h1>
    <p>Cette page simule une instance n8n pour tester l'extension Chrome avec Firebase Auth + Pricing.</p>

    <h2>📋 Checklist d'installation</h2>
    <div id="installation-status">
        <div class="status info">
            ✅ Extension installée en mode développeur<br>
            ✅ Permissions accordées<br>
            ✅ Backend Railway opérationnel<br>
            ✅ Firebase configuré<br>
            ✅ Stripe configuré
        </div>
    </div>

    <h2>🎯 Tests à effectuer</h2>
    
    <h3>1. Test d'authentification</h3>
    <button class="test-btn" onclick="testAuth()">🔐 Tester l'authentification</button>
    <p>Ouvrez l'extension (bouton 🤖) → Modal d'auth doit apparaître</p>

    <h3>2. Test des quotas</h3>
    <button class="test-btn" onclick="testQuota()">📊 Tester les quotas</button>
    <p>Générez des workflows pour voir la barre de quota en temps réel</p>

    <h3>3. Test du pricing</h3>
    <button class="test-btn" onclick="testPricing()">💳 Tester Stripe</button>
    <p>Atteignez la limite FREE → Popup "Go Pro" → Stripe Checkout</p>

    <h3>4. Test API Backend</h3>
    <button class="test-btn" onclick="testBackend()">🌐 Tester le backend</button>
    <p>Vérifier que Railway répond correctement</p>

    <div class="results" id="results">
        <h3>📊 Résultats des tests</h3>
        <p>Les résultats apparaîtront ici...</p>
    </div>

    <h2>🔧 Configuration Firebase Frontend</h2>
    <pre id="firebase-config">
FIREBASE_CONFIG: {
  apiKey: "AIzaSyDPB8tHayuvKuhimMQPbJBBLvukFLJIZ8I",
  authDomain: "vibe-n8n-7e40d.firebaseapp.com",
  projectId: "vibe-n8n-7e40d",
  storageBucket: "vibe-n8n-7e40d.firebasestorage.app",
  messagingSenderId: "247816285693",
  appId: "1:247816285693:web:1229eea4a52d6d765afd94",
  measurementId: "G-1CLFCN7KVL"
}
    </pre>

    <h2>📡 URLs de test</h2>
    <ul>
        <li><strong>Backend API:</strong> <a href="https://vibe-n8n-production.up.railway.app/api" target="_blank">https://vibe-n8n-production.up.railway.app/api</a></li>
        <li><strong>Status:</strong> <a href="https://vibe-n8n-production.up.railway.app/api/status" target="_blank">https://vibe-n8n-production.up.railway.app/api/status</a></li>
        <li><strong>Pricing:</strong> <a href="https://vibe-n8n-production.up.railway.app/api/pricing" target="_blank">https://vibe-n8n-production.up.railway.app/api/pricing</a></li>
    </ul>

    <h2>🚨 Problèmes courants</h2>
    <div class="status warning">
        <strong>Extension ne se charge pas :</strong><br>
        • Vérifiez chrome://extensions/<br>
        • Rechargez l'extension<br>
        • Vérifiez la console (F12)
    </div>

    <div class="status warning">
        <strong>Modal d'auth n'apparaît pas :</strong><br>
        • Vérifiez que vous êtes sur une page "n8n"<br>
        • Ouvrez la console pour voir les logs Firebase<br>
        • Vérifiez les permissions dans manifest.json
    </div>

    <div class="status warning">
        <strong>Erreurs Firebase :</strong><br>
        • Vérifiez la configuration FIREBASE_CONFIG<br>
        • Vérifiez que l'app web est créée dans Firebase Console<br>
        • Vérifiez les domaines autorisés
    </div>

    <script>
        function updateResults(message, type = 'info') {
            const results = document.getElementById('results');
            const timestamp = new Date().toLocaleTimeString();
            results.innerHTML += `
                <div class="status ${type}">
                    <strong>[${timestamp}]</strong> ${message}
                </div>
            `;
        }

        async function testAuth() {
            updateResults('🔐 Test d\'authentification en cours...', 'info');
            
            // Simuler l'ouverture de l'extension
            updateResults('Ouvrez l\'extension (bouton 🤖 en bas à droite)', 'warning');
            updateResults('Vérifiez si la modal d\'authentification apparaît', 'info');
            
            // Vérifier si Firebase est disponible
            if (typeof firebase !== 'undefined') {
                updateResults('✅ Firebase SDK détecté', 'success');
            } else {
                updateResults('❌ Firebase SDK non détecté (normal, géré par l\'extension)', 'info');
            }
        }

        async function testQuota() {
            updateResults('📊 Test des quotas...', 'info');
            updateResults('Générez des workflows avec l\'extension pour voir la barre de quota', 'info');
            updateResults('Surveillez l\'header de l\'extension pour les informations utilisateur', 'info');
        }

        async function testPricing() {
            updateResults('💳 Test du pricing...', 'info');
            updateResults('Générez suffisamment de workflows pour atteindre la limite FREE (70k tokens)', 'info');
            updateResults('Popup "Go Pro" devrait apparaître automatiquement', 'warning');
        }

        async function testBackend() {
            updateResults('🌐 Test du backend Railway...', 'info');
            
            try {
                const response = await fetch('https://vibe-n8n-production.up.railway.app/api');
                const data = await response.json();
                
                if (data.pricing_ready) {
                    updateResults('✅ Backend opérationnel avec pricing activé', 'success');
                    updateResults(`Version: ${data.version} | System: ${data.system}`, 'info');
                } else {
                    updateResults('⚠️ Backend opérationnel mais pricing non configuré', 'warning');
                }
            } catch (error) {
                updateResults(`❌ Erreur backend: ${error.message}`, 'error');
            }

            try {
                const statusResponse = await fetch('https://vibe-n8n-production.up.railway.app/api/status');
                const statusData = await statusResponse.json();
                updateResults(`✅ Status: ${statusData.status} | Uptime: ${Math.round(statusData.uptime)}s`, 'success');
            } catch (error) {
                updateResults(`❌ Erreur status: ${error.message}`, 'error');
            }
        }

        // Auto-test au chargement de la page
        window.addEventListener('load', () => {
            updateResults('🚀 Page de test chargée', 'success');
            updateResults('Suivez les étapes ci-dessus pour tester l\'extension', 'info');
            
            // Test automatique du backend
            setTimeout(testBackend, 1000);
        });

        // Simuler une page n8n
        document.title = 'n8n - Workflow Automation | Test Environment';
        
        // Ajouter des classes n8n simulées
        document.body.classList.add('n8n-test-environment');
        
        // Message pour l'extension
        console.log('🧪 Test environment ready for Vibe n8n extension');
        console.log('📍 Location:', window.location.href);
        console.log('🎯 This page simulates n8n environment for extension testing');
    </script>
</body>
</html> 